
import itertools
import base64
import math
import time
import sys
#matrix used to permutate the plaintext
P=[69,45,30,128,38,95,23,73,71,53,82,31,99,111,106,79,
   97,101,107,113,4,25,49,94,44,119,75,76,83,92,17,67,
   88,51,104,81,100,58,102,77,87,103,121,22,123,124,32,59,
   96,55,68,122,8,29,105,20,56,61,11,62,127,2,84,65,
   108,10,66,74,24,80,47,54,3,39,26,117,118,18,57,64,
   14,110,48,93,37,116,70,12,98,28,115,63,91,125,33,6,
   21,114,41,27,90,15,60,50,85,78,126,34,35,5,40,42,
   43,72,7,13,89,1,36,9,19,112,52,109,16,120,86,46]
#inverse matrix for decryption
PI_1=[118, 62, 73, 21, 110, 96, 115, 53, 120, 66, 59, 88, 116, 81, 102, 125,
      31, 78, 121, 56, 97, 44, 7, 69, 22, 75, 100, 90, 54, 3, 12, 47,
      95, 108, 109, 119, 85, 5, 74, 111, 99, 112, 113, 25, 2, 128, 71, 83, 
      23, 104, 34, 123, 10, 72, 50, 57, 79, 38, 48, 103, 58, 60, 92, 80,
      64, 67, 32, 51, 1, 87, 9, 114, 8, 68, 27, 28, 40, 106, 16, 70,
      36, 11, 29, 63, 105, 127, 41, 33, 117, 101, 93, 30, 84, 24, 6, 49,
      17, 89, 13, 37, 18, 39, 42, 35, 55, 15, 19, 65, 124, 82, 14, 122,
      20, 98, 91, 86, 76, 77, 26, 126, 43, 52, 45, 46, 94, 107, 61, 4]

P1=[15,13,9,31,7,21,27,8,
    5,4,26,10,14,16,17,23,
    2,29,32,20,25,1,3,6,
    19,28,11,18,22,12,30,24]

P1_I=[22, 17, 23, 10, 9, 24, 5, 8,
      3, 12, 27, 30, 2, 13, 1, 14, 
      15, 28, 25, 20, 6, 29, 16, 32,
      21, 11, 7, 26, 18, 31, 4,19]

compression_table=[1,14,17,11,24,60,5,39,
                   2,15,6,21,10,23,19,23,
                   3,26,45,16,7,27,20,13,
                   4,41,52,31,37,47,55,30]


# data="12347681"
data="02481261200422271159219265559171113481902085146511292292539910925122841212121605127153221241442451224913116715224854142701526598862192217319117111163081591797722174189173178174234124246103201422174910912914064116013133161161216020512251372211394741512842961121702362371889579107222123247223197194222981167024716987139651361578721812621012719717131163911791522512365510818990139253160187233421278619824023014432172421930166183451571602611966317418646219129232113521798123110122501996569169224874461031991182471188108832111348189149194865242229100139171701485829143185202112217213766130103154132812326885591561981536198989810592233143193902085216144210932301909406841351302509655951661494252114188237502106881102781959430346812413320019119522689701581762159511612476139971037124411932591456216345820713111621742116681116560175161335721220195111311831762041962261581911951112052481721181596613013356253217223197248932410213110832026452351012919341906125097901217975557116111024812912004222711592192655591711131761892085146251927713023411727962391911281812006289103129455115212510217116417020523519653221415652612722824211029109991512422432131351267715462762152262296542131135211158431420097318921771888966249235151115121141009997315752381063224209184176422271891170165518919636112973114128132131319108121312432318364170179313614411911417848731513117216133197361642257815944188325035165403417410524810327111411652501444619681917199222167248352492377137119653183104149217136108160187250749319325242241051968723122910975100115145150961101203373251210085109732361669631704413317021944993331322058510189431875376151139584112182216119113153205522177097211575644512723625213925298169984520390111691687068214612334251197195118325170105162377719217481215852468431822481916225316323659754228318041727221112214720082215138140146141149204182208180147140211313616013121151391605255917480262367511111105517931255216297101848245241164164108511181988810816026111024812612004222711592192655591711132401612085146292091434525523190224121140239130135180194801092381620468202238130357412341251931308797112133215226152193210196382041601051602072441551015124918618759201113184631486515436140672411041259738141169117169164212161123112184149143225533566190339713087164226157246170605114921965130151224211498111651912811820221820144189681601883155155137422475511611857150146230472272611588223185133516036130162105221241229779417323524484153196230253159209721882528018987231866220936501961601682491362047812417723422823221618112424215177139180244760141107619515319580105102521873220206150423414013861691291432411703422624711223118646251153210218951561342154512501323516825016123414446198931936698252596577013020525477356461199208163109383252193262368913632104161442235312459247121871323813364218292042141615066233247631041992296014831202102372291362822421941225165183432251211912222541392008023632234695109501746676181141225160252103100342072171212101477925217518153136539719221511102321271200422271159219265559171113481442085146142439262121091621616824688711751751193113863151128172302081720018523115621818310642186571849018917523817343372592022127361401062375413286199141168249202312282541231061361115422420417314121203122176240249114103522420259501907116836200160121241245223194203216582011612231350571320221876158183194231154106106971752034319611116552220197711321031611414116819416245813819821938211209108738222108218141018151081127431856511223712440151906291204233159161241179229111611523016825191420722721218423224896233158511914996113567220063165781712489315571131240667725074702085027166158332350951591898210224518129302012504618511920178105249100872512512348915815451152442166367731361314823717913721611418370103105242100101395222001815780723474711711501687477156251159617392188361161582142441972486103431592264113971972032162082071751718819509919624425446282354018834234202492301031248124788433319802814012511959431467711211922869139645318162211234217111000000000000000000000000000000000000000000000000000000000000000000000000000000000248126120042227115921926555917111348190208514651129229253991092512284121212160512715322124144245122491311671522485414270152659886219221731911711116308159179772217418917317817423412424610320142217491091291406411601313316116121602051225137221139474151284296112170236237188957910722212324722319719422298116702471698713965136157872181262101271971713116391179152251236551081899013925316018723342127861982402301443217242193016618345157160261196631741864621912923211352179812311012250199656916922487446103199118247118810883211134818914919486524222910013917170148582914318520211221721376613010315413281232688559156198153619898981059223314319390208521614421093230190940684135130250965595166149425211418823750210688110278195943034681241332001911952268970158176215951161247613997103712441193259145621634582071311162174211668111656017516133572122019511131183176204196226158191195111205248172118159661301335625321722319724893241021311083202645235101291934190612509790121797555711611102481291200422271159219265559171113176189208514625192771302341172796239191128181200628910312945511521251021711641702052351965322141565261272282421102910999151242243213135126771546276215226229654213113521115843142009731892177188896624923515111512114100999731575238106322420918417642227189117016551891963611297311412813213131910812131243231836417017931361441191141784873151311721613319736164225781594418832503516540341741052481032711141165250144461968191719922216724835249237713711965318310414921713610816018725074931932524224105196872312291097510011514515096110120337325121008510973236166963170441331702194499333132205851018943187537615113958411218221611911315320552217709721157564451272362521392529816998452039011169168706821461233425119719511832517010516237771921748121585246843182248191622531632365975422831804172722111221472008221513814014614114920418220818014714021131361601312115139160525591748026236751111110551793125521629710184824524116416410851118198881081602611102481261200422271159219265559171113240161208514629209143452552319022412114023913013518019480109238162046820223813035741234125193130879711213321522615219321019638204160105160207244155101512491861875920111318463148651543614067241104125973814116911716916421216112311218414914322553356619033971308716422615724617060511492196513015122421149811165191281182022182014418968160188315515513742247551161185715014623047227261158822318513351603613016210522124122977941732352448415319623025315920972188252801898723186622093650196160168249136204781241772342282322161811242421517713918024476014110761951531958010510252187322020615042341401386169129143241170342262471122311864625115321021895156134215451250132351682501612341444619893193669825259657701302052547735646119920816310938325219326236891363210416144223531245924712187132381336421829204214161506623324763104199229601483120210237229136282242194122516518343225121191222254139200802363223469510950174667618114122516025210310034207217121210147792521751815313653971922151110232127120042227115921926555917111348144208514614243926212109162161682468871175175119311386315112817230208172001852311562181831064218657184901891752381734337259202212736140106237541328619914116824920231228254123106136111542242041731412120312217624024911410352242025950190711683620016012124124522319420321658201161223135057132022187615818319423115410610697175203431961111655222019771132103161141411681941624581381982193821120910873822210821814101815108112743185651122371244015190629120423315916124117922911161152301682519142072272121842322489623315851191499611356722006316578171248931557113124066772507470208502716615833235095159189821022451812930201250461851192017810524910087251251234891581545115244216636773136131482371791372161141837010310524210010139522200181578072347471171150168747715625115961739218836116158214244197248610343159226411397197203216208207175171881950991962442544628235401883423420249230103124812478843331980281401251195943146771121192286913964531816221123421711100000000000000000000000000000000000000000000000000000000000000000000000000000000024812612004222711592192655591711134819020851465112922925399109251228412121216051271532212414424512249131167152248541427015265988621922173191171111630815917977221741891731781742341242461032014221749109129140641160131331611612160205122513722113947415128429611217023623718895791072221232472231971942229811670247169871396513615787218126210127197171311639117915225123655108189901392531601872334212786198240230144321724219301661834515716026119663174186462191292321135217981231101225019965691692248744610319911824711881088321113481891491948652422291001391717014858291431852021122172137661301031541328123268855915619815361989898105922331431939020852161442109323019094068413513025096559516614942521141882375021068811027819594303468124133200191195226897015817621595116124761399710371244119325914562163458207131116217421166811165601751613357212201951113118317620419622615819119511120524817211815966130133562532172231972489324102131108320264523510129193419061250979012179755571161110248129120042227115921926555917111317618920851462519277130234117279623919112818120062891031294551152125102171164170205235196532214156526127228242110291099915124224321313512677154627621522622965421311352111584314200973189217718889662492351511151211410099973157523810632242091841764222718911701655189196361129731141281321313191081213124323183641701793136144119114178487315131172161331973616422578159441883250351654034174105248103271114116525014446196819171992221672483524923771371196531831041492171361081601872507493193252422410519687231229109751001151451509611012033732512100851097323616696317044133170219449933313220585101894318753761511395841121822161191131532055221770972115756445127236252139252981699845203901116916870682146123342511971951183251701051623777192174812158524684318224819162253163236597542283180417272211122147200822151381401461411492041822081801471402113136160131211513916052559174802623675111111055179312552162971018482452411641641085111819888108160261110248126120042227115921926555917111324016120851462920914345255231902241211402391301351801948010923816204682022381303574123412519313087971121332152261521932101963820416010516020724415510151249186187592011131846314865154361406724110412597381411691171691642121611231121841491432255335661903397130871642261572461706051149219651301512242114981116519128118202218201441896816018831551551374224755116118571501462304722726115882231851335160361301621052212412297794173235244841531962302531592097218825280189872318662209365019616016824913620478124177234228232216181124242151771391802447601411076195153195801051025218732202061504234140138616912914324117034226247112231186462511532102189515613421545125013235168250161234144461989319366982525965770130205254773564611992081631093832521932623689136321041614422353124592471218713238133642182920421416150662332476310419922960148312021023722913628224219412251651834322512119122225413920080236322346951095017466761811412251602521031003420721712121014779252175181531365397192215111023212712004222711592192655591711134814420851461424392621210916216168246887117517511931138631511281723020817200185231156218183106421865718490189175238173433725920221273614010623754132861991411682492023122825412310613611154224204173141212031221762402491141035224202595019071168362001601212412452231942032165820116122313505713202218761581831942311541061069717520343196111165522201977113210316114141168194162458138198219382112091087382221082181410181510811274318565112237124401519062912042331591612411792291116115230168251914207227212184232248962331585119149961135672200631657817124893155711312406677250747020850271661583323509515918982102245181293020125046185119201781052491008725125123489158154511524421663677313613148237179137216114183701031052421001013952220018157807234747117115016874771562511596173921883611615821424419724861034315922641139719720321620820717517188195099196244254462823540188342342024923010312481247884333198028140125119594314677112119228691396453181622112342171110000000000000000000000000000000000000000000000000000000000000000000000000000000002481261200422271159219265559171113481902085146511292292539910925122841212121605127153221241442451224913116715224854142701526598862192217319117111163081591797722174189173178174234124246103201422174910912914064116013133161161216020512251372211394741512842961121702362371889579107222123247223197194222981167024716987139651361578721812621012719717131163911791522512365510818990139253160187233421278619824023014432172421930166183451571602611966317418646219129232113521798123110122501996569169224874461031991182471188108832111348189149194865242229100139171701485829143185202112217213766130103154132812326885591561981536198989810592233143193902085216144210932301909406841351302509655951661494252114188237502106881102781959430346812413320019119522689701581762159511612476139971037124411932591456216345820713111621742116681116560175161335721220195111311831762041962261581911951112052481721181596613013356253217223197248932410213110832026452351012919341906125097901217975557116111024812912004222711592192655591711131761892085146251927713023411727962391911281812006289103129455115212510217116417020523519653221415652612722824211029109991512422432131351267715462762152262296542131135211158431420097318921771888966249235151115121141009997315752381063224209184176422271891170165518919636112973114128132131319108121312432318364170179313614411911417848731513117216133197361642257815944188325035165403417410524810327111411652501444619681917199222167248352492377137119653183104149217136108160187250749319325242241051968723122910975100115145150961101203373251210085109732361669631704413317021944993331322058510189431875376151139584112182216119113153205522177097211575644512723625213925298169984520390111691687068214612334251197195118325170105162377719217481215852468431822481916225316323659754228318041727221112214720082215138140146141149204182208180147140211313616013121151391605255917480262367511111105517931255216297101848245241164164108511181988810816026111024812612004222711592192655591711132401612085146292091434525523190224121140239130135180194801092381620468202238130357412341251931308797112133215226152193210196382041601051602072441551015124918618759201113184631486515436140672411041259738141169117169164212161123112184149143225533566190339713087164226157246170605114921965130151224211498111651912811820221820144189681601883155155137422475511611857150146230472272611588223185133516036130162105221241229779417323524484153196230253159209721882528018987231866220936501961601682491362047812417723422823221618112424215177139180244760141107619515319580105102521873220206150423414013861691291432411703422624711223118646251153210218951561342154512501323516825016123414446198931936698252596577013020525477356461199208163109383252193262368913632104161442235312459247121871323813364218292042141615066233247631041992296014831202102372291362822421941225165183432251211912222541392008023632234695109501746676181141225160252103100342072171212101477925217518153136539719221511102321271200422271159219265559171113481442085146142439262121091621616824688711751751193113863151128172302081720018523115621818310642186571849018917523817343372592022127361401062375413286199141168249202312282541231061361115422420417314121203122176240249114103522420259501907116836200160121241245223194203216582011612231350571320221876158183194231154106106971752034319611116552220197711321031611414116819416245813819821938211209108738222108218141018151081127431856511223712440151906291204233159161241179229111611523016825191420722721218423224896233158511914996113567220063165781712489315571131240667725074702085027166158332350951591898210224518129302012504618511920178105249100872512512348915815451152442166367731361314823717913721611418370103105242100101395222001815780723474711711501687477156251159617392188361161582142441972486103431592264113971972032162082071751718819509919624425446282354018834234202492301031248124788433319802814012511959431467711211922869139645318162211234217111000000000000000000000000000000000000000000000000000000000000000000000000000000000248126120042227115921926555917111348190208514651129229253991092512284121212160512715322124144245122491311671522485414270152659886219221731911711116308159179772217418917317817423412424610320142217491091291406411601313316116121602051225137221139474151284296112170236237188957910722212324722319719422298116702471698713965136157872181262101271971713116391179152251236551081899013925316018723342127861982402301443217242193016618345157160261196631741864621912923211352179812311012250199656916922487446103199118247118810883211134818914919486524222910013917170148582914318520211221721376613010315413281232688559156198153619898981059223314319390208521614421093230190940684135130250965595166149425211418823750210688110278195943034681241332001911952268970158176215951161247613997103712441193259145621634582071311162174211668111656017516133572122019511131183176204196226158191195111205248172118159661301335625321722319724893241021311083202645235101291934190612509790121797555711611102481291200422271159219265559171113176189208514625192771302341172796239191128181200628910312945511521251021711641702052351965322141565261272282421102910999151242243213135126771546276215226229654213113521115843142009731892177188896624923515111512114100999731575238106322420918417642227189117016551891963611297311412813213131910812131243231836417017931361441191141784873151311721613319736164225781594418832503516540341741052481032711141165250144461968191719922216724835249237713711965318310414921713610816018725074931932524224105196872312291097510011514515096110120337325121008510973236166963170441331702194499333132205851018943187537615113958411218221611911315320552217709721157564451272362521392529816998452039011169168706821461233425119719511832517010516237771921748121585246843182248191622531632365975422831804172722111221472008221513814014614114920418220818014714021131361601312115139160525591748026236751111110551793125521629710184824524116416410851118198881081602611102481261200422271159219265559171113240161208514629209143452552319022412114023913013518019480109238162046820223813035741234125193130879711213321522615219321019638204160105160207244155101512491861875920111318463148651543614067241104125973814116911716916421216112311218414914322553356619033971308716422615724617060511492196513015122421149811165191281182022182014418968160188315515513742247551161185715014623047227261158822318513351603613016210522124122977941732352448415319623025315920972188252801898723186622093650196160168249136204781241772342282322161811242421517713918024476014110761951531958010510252187322020615042341401386169129143241170342262471122311864625115321021895156134215451250132351682501612341444619893193669825259657701302052547735646119920816310938325219326236891363210416144223531245924712187132381336421829204214161506623324763104199229601483120210237229136282242194122516518343225121191222254139200802363223469510950174667618114122516025210310034207217121210147792521751815313653971922151110232127120042227115921926555917111348144208514614243926212109162161682468871175175119311386315112817230208172001852311562181831064218657184901891752381734337259202212736140106237541328619914116824920231228254123106136111542242041731412120312217624024911410352242025950190711683620016012124124522319420321658201161223135057132022187615818319423115410610697175203431961111655222019771132103161141411681941624581381982193821120910873822210821814101815108112743185651122371244015190629120423315916124117922911161152301682519142072272121842322489623315851191499611356722006316578171248931557113124066772507470208502716615833235095159189821022451812930201250461851192017810524910087251251234891581545115244216636773136131482371791372161141837010310524210010139522200181578072347471171150168747715625115961739218836116158214244197248610343159226411397197203216208207175171881950991962442544628235401883423420249230103124812478843331980281401251195943146771121192286913964531816221123421711100000000000000000000000000000000000000000000000000000000000000000000000000000000024812612004222711592192655591711134819020851465112922925399109251228412121216051271532212414424512249131167152248541427015265988621922173191171111630815917977221741891731781742341242461032014221749109129140641160131331611612160205122513722113947415128429611217023623718895791072221232472231971942229811670247169871396513615787218126210127197171311639117915225123655108189901392531601872334212786198240230144321724219301661834515716026119663174186462191292321135217981231101225019965691692248744610319911824711881088321113481891491948652422291001391717014858291431852021122172137661301031541328123268855915619815361989898105922331431939020852161442109323019094068413513025096559516614942521141882375021068811027819594303468124133200191195226897015817621595116124761399710371244119325914562163458207131116217421166811165601751613357212201951113118317620419622615819119511120524817211815966130133562532172231972489324102131108320264523510129193419061250979012179755571161110248129120042227115921926555917111317618920851462519277130234117279623919112818120062891031294551152125102171164170205235196532214156526127228242110291099915124224321313512677154627621522622965421311352111584314200973189217718889662492351511151211410099973157523810632242091841764222718911701655189196361129731141281321313191081213124323183641701793136144119114178487315131172161331973616422578159441883250351654034174105248103271114116525014446196819171992221672483524923771371196531831041492171361081601872507493193252422410519687231229109751001151451509611012033732512100851097323616696317044133170219449933313220585101894318753761511395841121822161191131532055221770972115756445127236252139252981699845203901116916870682146123342511971951183251701051623777192174812158524684318224819162253163236597542283180417272211122147200822151381401461411492041822081801471402113136160131211513916052559174802623675111111055179312552162971018482452411641641085111819888108160261110248126120042227115921926555917111324016120851462920914345255231902241211402391301351801948010923816204682022381303574123412519313087971121332152261521932101963820416010516020724415510151249186187592011131846314865154361406724110412597381411691171691642121611231121841491432255335661903397130871642261572461706051149219651301512242114981116519128118202218201441896816018831551551374224755116118571501462304722726115882231851335160361301621052212412297794173235244841531962302531592097218825280189872318662209365019616016824913620478124177234228232216181124242151771391802447601411076195153195801051025218732202061504234140138616912914324117034226247112231186462511532102189515613421545125013235168250161234144461989319366982525965770130205254773564611992081631093832521932623689136321041614422353124592471218713238133642182920421416150662332476310419922960148312021023722913628224219412251651834322512119122225413920080236322346951095017466761811412251602521031003420721712121014779252175181531365397192215111023212712004222711592192655591711134814420851461424392621210916216168246887117517511931138631511281723020817200185231156218183106421865718490189175238173433725920221273614010623754132861991411682492023122825412310613611154224204173141212031221762402491141035224202595019071168362001601212412452231942032165820116122313505713202218761581831942311541061069717520343196111165522201977113210316114141168194162458138198219382112091087382221082181410181510811274318565112237124401519062912042331591612411792291116115230168251914207227212184232248962331585119149961135672200631657817124893155711312406677250747020850271661583323509515918982102245181293020125046185119201781052491008725125123489158154511524421663677313613148237179137216114183701031052421001013952220018157807234747117115016874771562511596173921883611615821424419724861034315922641139719720321620820717517188195099196244254462823540188342342024923010312481247884333198028140125119594314677112119228691396453181622112342171110000000000000000000000000000000000000000000000000000000000000000000000000000000002481261200422271159219265559171113481902085146511292292539910925122841212121605127153221241442451224913116715224854142701526598862192217319117111163081591797722174189173178174234124246103201422174910912914064116013133161161216020512251372211394741512842961121702362371889579107222123247223197194222981167024716987139651361578721812621012719717131163911791522512365510818990139253160187233421278619824023014432172421930166183451571602611966317418646219129232113521798123110122501996569169224874461031991182471188108832111348189149194865242229100139171701485829143185202112217213766130103154132812326885591561981536198989810592233143193902085216144210932301909406841351302509655951661494252114188237502106881102781959430346812413320019119522689701581762159511612476139971037124411932591456216345820713111621742116681116560175161335721220195111311831762041962261581911951112052481721181596613013356253217223197248932410213110832026452351012919341906125097901217975557116111024812912004222711592192655591711131761892085146251927713023411727962391911281812006289103129455115212510217116417020523519653221415652612722824211029109991512422432131351267715462762152262296542131135211158431420097318921771888966249235151115121141009997315752381063224209184176422271891170165518919636112973114128132131319108121312432318364170179313614411911417848731513117216133197361642257815944188325035165403417410524810327111411652501444619681917199222167248352492377137119653183104149217136108160187250749319325242241051968723122910975100115145150961101203373251210085109732361669631704413317021944993331322058510189431875376151139584112182216119113153205522177097211575644512723625213925298169984520390111691687068214612334251197195118325170105162377719217481215852468431822481916225316323659754228318041727221112214720082215138140146141149204182208180147140211313616013121151391605255917480262367511111105517931255216297101848245241164164108511181988810816026111024812612004222711592192655591711132401612085146292091434525523190224121140239130135180194801092381620468202238130357412341251931308797112133215226152193210196382041601051602072441551015124918618759201113184631486515436140672411041259738141169117169164212161123112184149143225533566190339713087164226157246170605114921965130151224211498111651912811820221820144189681601883155155137422475511611857150146230472272611588223185133516036130162105221241229779417323524484153196230253159209721882528018987231866220936501961601682491362047812417723422823221618112424215177139180244760141107619515319580105102521873220206150423414013861691291432411703422624711223118646251153210218951561342154512501323516825016123414446198931936698252596577013020525477356461199208163109383252193262368913632104161442235312459247121871323813364218292042141615066233247631041992296014831202102372291362822421941225165183432251211912222541392008023632234695109501746676181141225160252103100342072171212101477925217518153136539719221511102321271200422271159219265559171113481442085146142439262121091621616824688711751751193113863151128172302081720018523115621818310642186571849018917523817343372592022127361401062375413286199141168249202312282541231061361115422420417314121203122176240249114103522420259501907116836200160121241245223194203216582011612231350571320221876158183194231154106106971752034319611116552220197711321031611414116819416245813819821938211209108738222108218141018151081127431856511223712440151906291204233159161241179229111611523016825191420722721218423224896233158511914996113567220063165781712489315571131240667725074702085027166158332350951591898210224518129302012504618511920178105249100872512512348915815451152442166367731361314823717913721611418370103105242100101395222001815780723474711711501687477156251159617392188361161582142441972486103431592264113971972032162082071751718819509919624425446282354018834234202492301031248124788433319802814012511959431467711211922869139645318162211234217111000000000000000000000000000000000000000000000000000000000000000000000000000000000248126120042227115921926555917111348190208514651129229253991092512284121212160512715322124144245122491311671522485414270152659886219221731911711116308159179772217418917317817423412424610320142217491091291406411601313316116121602051225137221139474151284296112170236237188957910722212324722319719422298116702471698713965136157872181262101271971713116391179152251236551081899013925316018723342127861982402301443217242193016618345157160261196631741864621912923211352179812311012250199656916922487446103199118247118810883211134818914919486524222910013917170148582914318520211221721376613010315413281232688559156198153619898981059223314319390208521614421093230190940684135130250965595166149425211418823750210688110278195943034681241332001911952268970158176215951161247613997103712441193259145621634582071311162174211668111656017516133572122019511131183176204196226158191195111205248172118159661301335625321722319724893241021311083202645235101291934190612509790121797555711611102481291200422271159219265559171113176189208514625192771302341172796239191128181200628910312945511521251021711641702052351965322141565261272282421102910999151242243213135126771546276215226229654213113521115843142009731892177188896624923515111512114100999731575238106322420918417642227189117016551891963611297311412813213131910812131243231836417017931361441191141784873151311721613319736164225781594418832503516540341741052481032711141165250144461968191719922216724835249237713711965318310414921713610816018725074931932524224105196872312291097510011514515096110120337325121008510973236166963170441331702194499333132205851018943187537615113958411218221611911315320552217709721157564451272362521392529816998452039011169168706821461233425119719511832517010516237771921748121585246843182248191622531632365975422831804172722111221472008221513814014614114920418220818014714021131361601312115139160525591748026236751111110551793125521629710184824524116416410851118198881081602611102481261200422271159219265559171113240161208514629209143452552319022412114023913013518019480109238162046820223813035741234125193130879711213321522615219321019638204160105160207244155101512491861875920111318463148651543614067241104125973814116911716916421216112311218414914322553356619033971308716422615724617060511492196513015122421149811165191281182022182014418968160188315515513742247551161185715014623047227261158822318513351603613016210522124122977941732352448415319623025315920972188252801898723186622093650196160168249136204781241772342282322161811242421517713918024476014110761951531958010510252187322020615042341401386169129143241170342262471122311864625115321021895156134215451250132351682501612341444619893193669825259657701302052547735646119920816310938325219326236891363210416144223531245924712187132381336421829204214161506623324763104199229601483120210237229136282242194122516518343225121191222254139200802363223469510950174667618114122516025210310034207217121210147792521751815313653971922151110232127120042227115921926555917111348144208514614243926212109162161682468871175175119311386315112817230208172001852311562181831064218657184901891752381734337259202212736140106237541328619914116824920231228254123106136111542242041731412120312217624024911410352242025950190711683620016012124124522319420321658201161223135057132022187615818319423115410610697175203431961111655222019771132103161141411681941624581381982193821120910873822210821814101815108112743185651122371244015190629120423315916124117922911161152301682519142072272121842322489623315851191499611356722006316578171248931557113124066772507470208502716615833235095159189821022451812930201250461851192017810524910087251251234891581545115244216636773136131482371791372161141837010310524210010139522200181578072347471171150168747715625115961739218836116158214244197248610343159226411397197203216208207175171881950991962442544628235401883423420249230103124812478843331980281401251195943146771121192286913964531816221123421711100000000000000000000000000000000000000000000000000000000000000000000000000000000"
# secret_key="yjayshil"
# pswd="ganesha"
def binvalue(val, bitsize): #Return the binary value as a string of the given size 
    binval = bin(val)[2:] if isinstance(val, int) else bin(ord(val))[2:]
    if len(binval) > bitsize:
        raise "binary value larger than the expected size"
    while len(binval) < bitsize:
        binval = "0"+binval #Add as many 0 as needed to get the wanted size
    return binval

def string_to_bit_array(text):#Convert a string into a list of bits
    array = list()
    for char in text:
        binval = binvalue(char, 8)#Get the char value on one byte
        array.extend([int(x) for x in list(binval)]) #Add the bits to the final list
    return array

def bit_array_to_string(array): #Recreate the string from the bit array
    res = ''.join([chr(int(y,2)) for y in [''.join([str(x) for x in _bytes]) for _bytes in  nsplit(array,8)]])   
    return res

def nsplit(s, n):#Split a list into sublists of size "n"
    return [s[k:k+n] for k in range(0, len(s), n)]

def permute(block, table):#Permut the given block using the given table (so generic method)
    return [block[x-1] for x in table]

def xor(l1, l2):#Apply a xor and return the resulting list
    return [x^y for x,y in zip(l1,l2)]

def addPadding(text):#Add padding to the datas using PKCS5 spec.
    pad_len = 16 - (len(text) % 16)
    text += pad_len * chr(pad_len)
    return [text,pad_len]
    
def removePadding(text,pad_len):#Remove the padding of the plain text (it assume there is padding)
    return text[:-pad_len]



   

def generate_subkey(plaintext,secretkey):   # Generate subkey for each round
    m=0 # M value which is added to the plaintext
    # RC4_key="w7jDuMOrJgRPwq0pJlJBw6wjw4oUwoTDn2RAwoTChMOfwqPChA=="
    keys=list()
    key_arr=string_to_bit_array(secretkey[:16])
    for i in range(len(plaintext)): # calculation M
         m=m+(ord(plaintext[i])*(i+1))
    m=m%len(plaintext)
    for i in range(len(plaintext)): #adding M to each character
        t= (ord(plaintext[i])+m)%256
        plaintext = plaintext[:i] + chr(t) + plaintext[i + 1:]
    
    for i in range(len(plaintext)//16):
        plaintext_arr=string_to_bit_array(plaintext[i*16:(i+1)*16])
        temp_arr=xor(plaintext_arr,key_arr)
        keys.append(bit_array_to_string(temp_arr))
    if len(keys)<8:
        diff=8-len(keys)
        for i in range(diff):
            keys.append(keys[i])
    
    return keys

def round(self,plaintext,subkey):
    subkey_L=subkey[:8]
    subkey_R=subkey[8:]
    round_key=""
    plaintext_L=plaintext[:4]
    plaintext_R=plaintext[4:]
    
    if string_to_bit_array(subkey)[0] == 0:
        round_key=subkey_R
    else:
        round_key=subkey_L
    
    #converting strings to bit arrays
    round_key_bit_array=string_to_bit_array(round_key)
    bit_array_L=string_to_bit_array(plaintext_L)
    
    bit_array_R=string_to_bit_array(plaintext_R)
    
    #compresion and XOR operation
    
    round_key_bit_array=permute(round_key_bit_array,compression_table)
    self.roundkeys.append(bit_array_to_string(round_key_bit_array))
    bit_array_R=xor(bit_array_R,round_key_bit_array) #performing XOR operation
    bit_array_R=shift(bit_array_R,1) #shifting bits to left
    
    bit_array_L=xor(bit_array_L,bit_array_R)
    
    
    bit_array_L=permute(bit_array_L,P1)
    encrypted_plaintext_R=bit_array_to_string(bit_array_R)
    encrypted_plaintext_L=bit_array_to_string(bit_array_L)
    result=encrypted_plaintext_R+encrypted_plaintext_L
    # print("{0} {1}".format(result,len(result)))
    return result

def reverse_round(plaintext,subkey):
    round_key=""
    plaintext_R=plaintext[:4]
    plaintext_L=plaintext[4:]
   
    
    #converting strings to bit arrays
    round_key_bit_array=string_to_bit_array(subkey)
    bit_array_L=string_to_bit_array(plaintext_L)
    bit_array_R=string_to_bit_array(plaintext_R)
    
    #applying inverse permutation
    bit_array_L=permute(bit_array_L,P1_I)
    bit_array_L=xor(bit_array_L,bit_array_R)
    #applying right shift
    bit_array_R=shift(bit_array_R,-1)
    
    bit_array_R=xor(bit_array_R,round_key_bit_array)
    
    decrypted_plaintext_L=bit_array_to_string(bit_array_L)
    decrypted_plaintext_R=bit_array_to_string(bit_array_R)
    result=decrypted_plaintext_L+decrypted_plaintext_R
    return result

def shift(arr,n):
    return arr[n:]+arr[:n]
    
    
ENCRYPT=1
DECRYPT=0


class algorithm():
    def __init__(self):
        self.pswd=None
        self.subkey=None
        self.subkeys=list()
        self.roundkeys=list()
        self.inputtext=None
        self.ispadding=False
        self.pad_len=0
    
    def perform_check(self,text):
        if len(text)%16!=0:
            text=addPadding(text)
            self.ispadding=True
        return text
    
    def encrypt(self,secret_key,plaintext):
        res=""
        if len(plaintext)%16!=0:
            plaintext,self.pad_len=addPadding(plaintext)
            self.ispadding=True
        self.pswd=secret_key
        self.inputtext=plaintext
        blocks=nsplit(self.inputtext,8)
        round_encrypted_result=None
        self.subkeys=generate_subkey(plaintext,secret_key)
        for block in blocks:
            roundtext=block
            for j in range(8):
                round_encrypted_result=round(self,roundtext,self.subkeys[j])
                # print("{0} used to convert {1} into {2}".format(self.subkeys[j],roundtext,round_encrypted_result))
                # print("{0} is converted to {1} using {2}".format(roundtext, round_encrypted_result,self.subkeys[j]))
                roundtext=round_encrypted_result
            
            res+=roundtext
        
        return res
    
    def decrypt(self,key,plaintext):
        res=""
        self.pswd=key
        self.inputtext=plaintext
        blocks=nsplit(self.inputtext,8)
        round_decrypted_result=None
        for block in blocks:
            roundtext=block
            for j in range(7,-1,-1):
                round_decrypted_result=reverse_round(roundtext,self.roundkeys[j])
                roundtext=round_decrypted_result
            res+=roundtext
        return res
#------------------------------------------------------------TESTING--------------------------------------------------------------------


# s=time.time()
# obj=algorithm()
# e=obj.encrypt("w7jDuMOrJgRPwq0pJlJBw6wjw4oUwoTDn2RAwoTChMOfwqPChA==",data)
# print("--- %s seconds ---" % (time.time() - s))
# print(len(data))
# print(len(e))




def get_text(path):
    f = open(path, "r")
    return f.read()

def write_text(text):
    f=open("D:\\d.txt","w",encoding="utf-8")
    f.write(text)

def run():
    argv = sys.argv
    obj=algorithm()

    if argv[1] == 'encrypt':
        data=get_text(argv[3])
        res=obj.encrypt(argv[2],data)
        write_text(res)
        print("hello")

    if argv[1] == 'decrypt':
        # print(argv[3])
        res=obj.decrypt(argv[2], argv[3])
        print(res)

    
if __name__ == '__main__':
    run()
# write_text(e)  